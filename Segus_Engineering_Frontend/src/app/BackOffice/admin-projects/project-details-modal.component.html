<!-- Modal de visualisation des détails de projet -->
<div class="modal-overlay" *ngIf="showViewModal" (click)="showViewModal = false">
  <div class="modal-content project-details-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-eye"></i> Détails du Projet</h3>
      <button class="modal-close" (click)="showViewModal = false">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="project-info-section" *ngIf="selectedProject">
        <!-- Informations générales -->
        <div class="info-card">
          <h4><i class="fas fa-info-circle"></i> Informations Générales</h4>
          <div class="info-grid">
            <div class="info-item">
              <label>Titre:</label>
              <span>{{ selectedProject.title }}</span>
            </div>
            <div class="info-item">
              <label>Description:</label>
              <span>{{ selectedProject.description || 'Aucune description' }}</span>
            </div>
            <div class="info-item">
              <label>Statut:</label>
              <span class="status-badge" [class]="'status-' + selectedProject.status">
                {{ getStatusLabel(selectedProject.status) }}
              </span>
            </div>
            <div class="info-item">
              <label>Date de début:</label>
              <span>{{ selectedProject.start_date | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="info-item">
              <label>Date de fin:</label>
              <span>{{ selectedProject.end_date | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="info-item">
              <label>Progression:</label>
              <div class="progress-container">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="selectedProject.progress_percentage || 0"></div>
                </div>
                <span class="progress-text">{{ selectedProject.progress_percentage || 0 }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Employés assignés -->
        <div class="info-card" *ngIf="selectedProject.assigned_employees && selectedProject.assigned_employees.length > 0">
          <h4><i class="fas fa-users"></i> Employés Assignés</h4>
          <div class="employees-list">
            <div class="employee-item" *ngFor="let employee of selectedProject.assigned_employees">
              <div class="employee-avatar">
                <i class="fas fa-user"></i>
              </div>
              <div class="employee-info">
                <span class="employee-name">{{ employee.full_name || employee.username }}</span>
                <span class="employee-email">{{ employee.email }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Tâches du projet -->
        <div class="info-card">
          <div class="card-header">
            <h4><i class="fas fa-tasks"></i> Tâches du Projet</h4>
            <button type="button" class="btn btn-sm btn-primary" (click)="openCreateTaskModal()">
              <i class="fas fa-plus"></i> Nouvelle tâche
            </button>
          </div>
          
          <div class="tasks-container" *ngIf="hasSelectedProjectTasks; else noTasks">
            <div class="task-card" *ngFor="let task of selectedProjectTasks; trackBy: trackByTaskId">
              <div class="task-header">
                <div class="task-title-section">
                  <h5>{{ task.title }}</h5>
                  <p class="task-description">{{ task.description }}</p>
                </div>
                <div class="task-actions">
                  <button type="button" class="btn btn-sm btn-outline-secondary" (click)="openEditTaskModal(task)" title="Modifier">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary" (click)="openCreateSubtaskModal(task)" title="Ajouter sous-tâche">
                    <i class="fas fa-plus"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-danger" (click)="deleteTask(task.id)" title="Supprimer">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              
              <div class="task-meta">
                <span class="task-status" [class]="'status-' + task.status">
                  {{ getTaskStatusLabel(task.status) }}
                </span>
                <span class="task-priority" [class]="'priority-' + task.priority">
                  {{ getPriorityLabel(task.priority) }}
                </span>
                <span class="task-dates">
                  <i class="fas fa-calendar"></i>
                  {{ task.start_date | date:'dd/MM' }} - {{ task.end_date | date:'dd/MM' }}
                </span>
                <span class="task-progress">
                  <i class="fas fa-chart-line"></i>
                  {{ task.progress_percentage || 0 }}%
                </span>
              </div>

              <!-- Sous-tâches -->
              <div class="subtasks-section" *ngIf="task.subtasks && task.subtasks.length > 0">
                <h6><i class="fas fa-list"></i> Sous-tâches ({{ task.subtasks.length }})</h6>
                <div class="subtasks-grid">
                  <div class="subtask-card" *ngFor="let subtask of task.subtasks; trackBy: trackBySubtaskId">
                    <div class="subtask-header">
                      <span class="subtask-name">{{ subtask.section_name }}</span>
                      <div class="subtask-actions">
                        <button type="button" class="btn btn-xs btn-outline-secondary" (click)="openEditSubtaskModal(subtask)">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" class="btn btn-xs btn-outline-danger" (click)="deleteSubtask(subtask.id)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </div>
                    <div class="subtask-details">
                      <span class="subtask-status" [class]="subtask.is_completed ? 'completed' : 'pending'">
                        <i class="fas" [class.fa-check-circle]="subtask.is_completed" [class.fa-clock]="!subtask.is_completed"></i>
                        {{ subtask.is_completed ? 'Terminée' : 'En cours' }}
                      </span>
                      <span class="subtask-km" *ngIf="subtask.kilometrage">
                        <i class="fas fa-road"></i>
                        {{ subtask.kilometrage }} km
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noTasks>
            <div class="no-tasks">
              <i class="fas fa-inbox"></i>
              <p>Aucune tâche créée pour ce projet.</p>
              <button type="button" class="btn btn-primary" (click)="openCreateTaskModal()">
                <i class="fas fa-plus"></i> Créer la première tâche
              </button>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="showViewModal = false">
        <i class="fas fa-times"></i> Fermer
      </button>
      <button type="button" class="btn btn-primary" (click)="openEditModal(selectedProject!)">
        <i class="fas fa-edit"></i> Modifier le projet
      </button>
    </div>
  </div>
</div>
