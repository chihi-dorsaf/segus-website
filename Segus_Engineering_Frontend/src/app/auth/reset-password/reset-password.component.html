<div class="reset-container">
  <div class="reset-card">
    <!-- Header Section -->
    <div class="header-section">
      <div class="logo-container">
        <i class="fas fa-shield-alt"></i>
      </div>
      <h1>Réinitialiser le mot de passe</h1>
      <p class="subtitle">Suivez les étapes pour récupérer l'accès à votre compte</p>
    </div>


    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <!-- Step 1: Email Form -->
    <div *ngIf="step === 1" class="form-section">
      <form [formGroup]="emailForm" (ngSubmit)="sendCode()">
        <div class="form-group">
          <label for="email">Adresse email</label>
          <div class="input-container" [class.error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
            <i class="fas fa-envelope input-icon"></i>
            <input
              id="email"
              type="email"
              formControlName="email"
              placeholder="votre.email@exemple.com"
            />
          </div>
          <div class="error-text" *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
            <span *ngIf="emailForm.get('email')?.errors?.['required']">L'adresse email est requise</span>
            <span *ngIf="emailForm.get('email')?.errors?.['email']">Veuillez entrer une adresse email valide</span>
          </div>
        </div>
        <button type="submit" class="btn-primary" [disabled]="emailForm.invalid || isLoading">
          {{ isLoading ? 'Envoi en cours...' : 'Envoyer le code' }}
          <i class="fas fa-arrow-right" *ngIf="!isLoading"></i>
        </button>
      </form>
    </div>

    <!-- Step 2: Code Verification -->
    <div *ngIf="step === 2" class="form-section">
      <div class="step-info">
        <p>Code envoyé à <strong>{{ emailForm.get('email')?.value }}</strong></p>
      </div>
      <form [formGroup]="codeForm" (ngSubmit)="verifyCode()">
        <div class="form-group">
          <label for="code">Code de vérification</label>
          <div class="input-container" [class.error]="codeForm.get('code')?.invalid && codeForm.get('code')?.touched">
            <i class="fas fa-shield-alt input-icon"></i>
            <input
              id="code"
              type="text"
              maxlength="6"
              formControlName="code"
              placeholder="000000"
              class="code-input"
            />
          </div>
          <div class="error-text" *ngIf="codeForm.get('code')?.invalid && codeForm.get('code')?.touched">
            <span *ngIf="codeForm.get('code')?.errors?.['required']">Le code est requis</span>
            <span *ngIf="codeForm.get('code')?.errors?.['minlength']">Le code doit contenir 6 chiffres</span>
          </div>
        </div>
        <button type="submit" class="btn-primary" [disabled]="codeForm.invalid || isLoading">
          {{ isLoading ? 'Vérification...' : 'Vérifier le code' }}
          <i class="fas fa-arrow-right" *ngIf="!isLoading"></i>
        </button>
      </form>
    </div>

    <!-- Step 3: New Password -->
    <div *ngIf="step === 3" class="form-section">
      <div class="step-info">
        <p>Choisissez un nouveau mot de passe sécurisé</p>
      </div>
      <form [formGroup]="passwordForm" (ngSubmit)="confirmPassword()">
        <div class="form-group">
          <label for="new_password">Nouveau mot de passe</label>
          <div class="input-container" [class.error]="passwordForm.get('new_password')?.invalid && passwordForm.get('new_password')?.touched">
            <i class="fas fa-lock input-icon"></i>
            <input
              id="new_password"
              type="password"
              formControlName="new_password"
              placeholder="••••••••"
            />
          </div>
          <div class="error-text" *ngIf="passwordForm.get('new_password')?.invalid && passwordForm.get('new_password')?.touched">
            <span *ngIf="passwordForm.get('new_password')?.errors?.['required']">Le mot de passe est requis</span>
            <span *ngIf="passwordForm.get('new_password')?.errors?.['minlength']">Au moins 6 caractères requis</span>
          </div>
        </div>
        <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || isLoading">
          {{ isLoading ? 'Confirmation...' : 'Confirmer le mot de passe' }}
          <i class="fas fa-arrow-right" *ngIf="!isLoading"></i>
        </button>
      </form>
    </div>

    <!-- Step 4: Success -->
    <div *ngIf="step === 4" class="success-section">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Mot de passe modifié !</h2>
      <p>Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.</p>
      <a routerLink="/login" class="btn-primary">
        Se connecter
        <i class="fas fa-arrow-right"></i>
      </a>
    </div>

    <!-- Back to Login Link -->
    <div class="back-link" *ngIf="step < 4">
      <a routerLink="/login" class="forgot-link">
        Retour à la connexion
      </a>
    </div>
  </div>
</div>


